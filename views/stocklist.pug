extends layout
block css 
  link(rel="stylesheet", href="css/stocklist.css")

block content
  include includes/sidebar.pug

  .main
    .container

      // --- STOCK LIST (ALL ENTRIES) ---
      section.table-section
        .container
          .header-row
            h2 STOCK LIST
            a.btn-add(href="/stockManager")
              i.fa-solid.fa-plus
              | Add Stock

          // Filter Bar
          .filter-bar
            input#filterName(type="text", placeholder="Filter by Product Name")
            select#filterType
              option(value="") All Types
              option(value="Furniture") Furniture
              option(value="Raw Materials") Raw Materials
              
          table#stockTable
            thead
              tr
                th Product Name
                th Product Type
                th Quantity
                th Cost Price
                th Selling Price
                //- th Supplier
                th Date
                th Quality
                th Actions
            tbody
              if items.length
                each item in items
                  tr
                    td #{item.name}
                    td #{item.type}
                    td #{item.qty}
                    td #{item.cost}
                    td #{item.price}
                    //- td #{item.supplier}
                    td #{moment(item.dateReceived).format("DD-MM-YYYY")}
                    td #{item.quality}
                    td.action-buttons
                      a.action-btn.edit(href=`/editstock/${item._id}`)
                        i.fa-solid.fa-pen-to-square
                        | Edit
                      form.delete-form(method="POST", action="/deletestock")
                        input(type="hidden", name="id", value=item._id)
                        input(type="hidden", name="productName", value=item.name)
                        button.action-btn.delete(type="submit")
                          i.fa-solid.fa-trash
                          | Delete
              else
                tr
                  td(colspan="10") No products in stock

      // --- STOCK SUMMARY (AGGREGATED) ---
      section.table-section
        .container
          .header-row
            h2 STOCK SUMMARY

          table#stockSummary
            thead
              tr
                th Product Name
                th Product Type
                th Total Quantity
                th Alerts
                th Avg Cost Price
                th Avg Selling Price
            tbody
              if summary && summary.length
                each item in summary
                  tr
                    td #{item._id.name}
                    td #{item._id.type}
                    td #{item.totalQty}
                    td
                      if item.totalQty <= 5
                        span.btn-warning Low Stock
                      else
                        | —
                    td #{item.avgCost.toFixed(2)}
                    td #{item.avgPrice.toFixed(2)}
              else
                tr
                  td(colspan="6") No products in stock

  // --- FOOTER ---
  footer.footer
    p © 2025 MWF. All rights reserved.
    p
      | Developed by 
      span.dev-name Mary Precious Ayebazibwe
      |  at 
      span.company-name Mayondo Wood & Furniture Ltd.

  // Confirmation Modal
  #confirmModal.modal
    .modal-content
      p#confirmMessage Are you sure you want to delete this product?
      .modal-actions
        button#confirmYes Yes, Delete
        button#confirmNo Cancel

  script(src="js/stocklist.js")
